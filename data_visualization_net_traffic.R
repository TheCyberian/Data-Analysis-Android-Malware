---
title: "data_visualization_net_traffic.R"
author: "Utkarsh Raghav"
---
#### Loading the required libraries
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("corrplot")) install.packages("corrplot")

library(viridis)
library(hrbrthemes)
library(ggrepel)

### Exploring the data set for referencing
head(df_android_net_traffic)
colnames(df_android_net_traffic)
view(df_android_net_traffic)

# Counting the number of data entries for each application type - malicious and benign 
plyr::count(df_android_net_traffic, vars='type')

# Converting the volume of data from bytes to mega bytes for a clearer visualization
cleaned_data_net_traffic$volume_mega_bytes <- cleaned_data_net_traffic$volume_bytes / 1000000

# Plotting the bar plot for Traffic size against the type of traffic
g <- cleaned_data_net_traffic %>% ggplot(aes(fill=type, x=type, y=volume_mega_bytes))
g + geom_bar(position="stack", stat="identity") +
  ggtitle("Studying Android Network Traffic Volume") +
  theme_bw() +
  theme(axis.text.x = element_text(size=15, angle=90, hjust = 0.95)) +
  xlab("Traffic Type") +
  ylab("Traffic Size (in megabytes)")


# Plotting the bar plot for number of Network Traffic DNS Queries against the type of traffic
g <- cleaned_data_net_traffic %>% ggplot(aes(fill=type, x=type, y=dns_query_times))
g + geom_bar(position="stack", stat="identity") +
  ggtitle("Studying Android Network Traffic DNS Queries") +
  theme_bw() +
  theme(axis.text.x = element_text(size=15, angle=90, hjust = 0.95)) +
  xlab("Query Type") +
  ylab("Number of DNS Queries")


# Converting source app bytes and remote app bytes to KiloBytes
cleaned_data_net_traffic$source_app_kilobytes <- cleaned_data_net_traffic$source_app_bytes / 1000
cleaned_data_net_traffic$remote_app_kilobytes <- cleaned_data_net_traffic$remote_app_bytes / 1000
# Dividing source app packet number by 1000 to get a better visualization
cleaned_data_net_traffic$source_app_packets_by_1000 <- cleaned_data_net_traffic$source_app_packets / 1000

# Plotting the bar plot for number of Source app packets against the type of traffic
g <- cleaned_data_net_traffic %>% ggplot(aes(fill=type, x=type, y=source_app_packets_by_1000))
g + geom_bar(position="stack", stat="identity") +
  ggtitle("Studying Android Network Traffic Source App Packets") +
  theme_bw() +
  theme(axis.text.x = element_text(size=15, angle=90, hjust = 0.95)) +
  xlab("Packet Type") +
  ylab("Source App Packets Number (X 1000)")


# Plotting a box plot for requests sent to external IPs against the traffic type.
b <- ggplot(cleaned_data_net_traffic, aes(x=type, y=external_ips))
b + geom_boxplot(
  color="blue", fill="blue", alpha=0.6,
  notch=TRUE, notchwidth = 0.6,
  outlier.colour="red", outlier.fill="red", outlier.size=3
) + labs(title = "Studying Android Network Traffic Source App Packets", x = "Packet Type", y = "External IP address")

# To find the correlation between the network traffic features, we used corrplot function
corr_matrix_b <- cor(as.matrix(benign_data_frame_net[,-1]))
corrplot(corr_matrix_b)
corrplot(corr_matrix_b,
         method = 'number',
         type = "lower")

corr_matrix_m <- cor(as.matrix(malicious_data_frame_net[,-1]))
corrplot(corr_matrix_m)
corrplot(corr_matrix_m,
         method = 'number',
         type = "lower")


# Plotting a scatter plot for remote application kilobyte against total network traffic volume in MB
a <- ggplot(cleaned_data_net_traffic, aes(x=remote_app_kilobytes, y=volume_mega_bytes))
a + geom_point(color="red", fill="blue", alpha=0.8) + 
  labs(
    title = "Studying Android Network Traffic Remote app bytes", 
    x = "Remote App KiloBytes", y = "Network Traffic Volume(in MB)"
  ) 

# Plotting a scatter plot for total network traffic volume in MB against total number of TCP packets
b <- ggplot(cleaned_data_net_traffic, aes(x=volume_mega_bytes, y=tcp_packets))
b + geom_point(color="magenta", fill="blue", alpha=0.8) + 
  labs(
    title = "Studying Android Network Traffic Remote app packets", 
    x = "Network Traffic Volume(in MB)", y = "Number of TCP Packets"
  ) 

# Plotting a scatter plot for total number of TCP packets against total number of remote app packets
c <- ggplot(cleaned_data_net_traffic, aes(x=remote_app_packets, y=tcp_packets))
c + geom_point(color="magenta", fill="blue", alpha=0.8) + 
  labs(
    title = "Studying Android Network Traffic Remote app packets", 
    x = "Number of Remote App Packets", y = "Number of TCP Packets"
  ) 
